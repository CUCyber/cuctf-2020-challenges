#!/bin/sh

SCRIPTPATH="$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"

timeout --foreground 300 qemu-system-x86_64 \
    -m 64M \
    -nographic \
    -kernel "${SCRIPTPATH}/bzImage" \
    -append "console=ttyS0 quiet loglevel=3 oops=panic panic=-1 pti=on kaslr nosmap min_addr=4096" \
    -cpu qemu64,+smep \
    -monitor /dev/null \
    -initrd "${SCRIPTPATH}/initramfs.cpio" \
    -enable-kvm \
#    -s \
#    -cpu qemu64 \
#    -smp 2 \
#    -smp cores=2 \
#    -smp threads=1